# 로드 밸런싱(Load Balancing)

## 로드 밸런싱이란 무엇일까?
> 둘 이상의 CPU(중앙처리장치)나 저장장치와 같은 컴퓨터 자원들에게 **작업(Work)을 나누어주는** 네트워크 기술
>
>가용성 및 응답시간을 최적화 할 수 있다.

#### 로드 밸런싱과 로드 밸런서
- 로드 밸런싱이란, 트래픽을 여러 서버에 균등하게 분산시켜주는 것이다.
	- 즉, 여러 서버에 `부하(Load)`를 나누어 주는 것. 
- 이때, 클라이언트와 서버 사이에서 작업을 분산시켜주는 주체를 `로드밸런서` 라고 한다.
	- 네트워크 허브 사이에 위치하기도 한다.

#### 로드 밸런싱의 기본 기능
1. Health Check (상태 확인)
	- 서버들의 상태를 주기적으로 확인하여, 서버 장애 여부를 판단한다.
	- `정상 동작 중인 서버로만 트래픽`을 보낸다.  
2. Tunneling (터널링)
	- 인터넷 상에서 `가상 파이프를 통해 데이터 스트림을 전달`시키는 기술
	- 패킷 내에 터널링 대상 데이터를 캡슐화하여 전송한다.
3. NAT (Network Address Translation)
	- 로드밸런서 외부의 공인 IP 주소와, 내부 네트워크의 사설 IP 주소를 번역/변환 해주는 역할
	- 즉, `IP 주소 변환기`
4. DSR (Destination Network Address Translation)
	- 서버에서 클라이언트로 되돌아가는 경우, 목적지를 클라이언트로 설정한 후, 네트워크 장비나 로드밸런서를 거치지 않고 `바로 클라이언트로` 찾아가는 방식
	- 로드밸런서 부하 감소 효과

## 로드 밸런싱 알고리즘
> - 라운드로빈 방식
> - IP 해시 방식
> - 최소 연결 방식
> 
> 이 외에도 가중 라운드로빈 방식, 대역폭 방식, 최소 응답시간 방식 등이 있다.

#### 라운드로빈 방식 (Round Robin)
- CPU 스케줄링의 라운드로빈 방식을 활용한 것.
- 서버로 들어온 `요청을 순서대로`` 돌아가며 배정하는 방식
- 서버들이 동일한 스펙을 갖고 있고, 서버와의 연결(세션)이 길게 유지되지 않는 경우 적절하다.

#### IP 해시 방식 (IP Hash)
- 클라이언트의 IP 주소를 특정 서버로 `매핑`해서 요청을 처리하는 방식
- 사용자의 IP를 `해싱`해서 부하를 분산하는 것이기 때문에, 사용자가 항상 동일한 서버로 연결되는 것을 보장한다.
- 즉, 경로가 보장된다.
- 접속자 수가 많을수록 분산과 효율이 높아진다.

#### 최소 연결 방식 (Least Connection)
- 요청이 들어온 시점에서, 가장 `적은 연결(세션)`` 상태인 서버에 트래픽을 할당하는 방식
- 세션이 자주 길어지거나, 서버에 분배된 트래픽이 일정하지 않은 경우 적합하다.

## 로드밸런서 장애 대비
> 갑작스러운 장애를 대비하여, 로드밸런서 서버를 이중화하여 구성한다.
> 
> 이때, 이중화된 두개의 밸런서는 각각 Active, Passive 상태이다.

``` user - internet - Cluster( duplicated Load Balancer) ```

#### 로드밸런서 장애 발생 시
1. 이중화되어있는 로드밸런서는 서로의 상태를 확인한다. (Health Check)
2. master 서버가 Fail되면, stanby 서버가 자동으로 master 서버의 역할을 한다.
	- stanby 서버는 평상시에는 passive 상태로 있다가, master 서버가 fail될 때만 active되어 작동한다.

``` 이 구성을 Fail Over라고 한다 ```