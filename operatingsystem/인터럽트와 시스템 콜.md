## 인터럽트와 시스템 콜

### 인터럽트 Interrupt

- 인터럽트란?
  - 프로그램 실행 중, 예기치 않은 상황이 발생한 경우, 현재 실행중인 작업을 즉시 중단하고, 우선적인 상황을 먼저 처리한 후, 실행중이던 작업으로 복귀하여 계속 처리하는 것

##### 인터럽트 과정

    1. 인터럽트 요청 발생
    2. 현재 프로그램 수행 중단
    3. PC에 기억되어있는 주소를 안전한 곳에 기억시켜 보존
        - 인터럽트 당한 시점의 레지스터와 PC(Program Counter)을 스택에 저장함
    4. 인터럽트 전처리 실행
        - 원인 파악
        - 처리 루틴 호출
    5. 인터럽트 서비스 루틴(ISR) 실행
        - 프로그램의 상태를 안전한 곳에 기억시켜 보존
        - 해결
    6. 보존시켜둔 PC의 값을 다시 PC에 복구. 보존시킨 프로그램의 상태를 중단 위치부터 계속 이어 수행

##### 인터럽트 종류

- 하드웨어 인터럽트
  - 하드웨어가 발생시킨 인터럽트
  - 입출력장치, 전원 등 외부적인 요인으로 발생함
  - ex) 키보드 입력, 타이머 종료
- 소프트웨어 인터럽트
  - 소프트웨어 명령에 의해 발생
  - 프로그램의 명령에 따라 명시적으로 발생시킬 수 있음
  - ex) 프로세스 간 통신이나 예외처리
- 예외 인터럽트
  - 프로세서가 실행 중 예외상황 감지할 떄 발생
  - ex) 프로그램 에러, 메모리 오류, 연산 오버플로우 등
- 외부 인터럽트
  - 외부 장치나 외부 시스템에서 발생하는 인터럽트
  - ex) 다른 컴퓨터 시스템과의 통신 중

##### 인터럽트의 필요성

- 컨트롤러가 입력을 받아들이는 방법: 폴링방식, 인터럽트 방식
  - 폴링 방식: 사용자가 명령어를 사용해 입력핀의 값을 계속 읽으며 변화를 알아내는 방식
    - 속도가 느리고 수행 효율 저하
  - 인터럽트 방식: MCU 자체가 하드웨어적으로 변화를 체크. 변화가 발생했을때만 동작
    - Daisy Chain
    - 병렬 우선순위 부여
- 인터럽트 방식은 신속한/실시간 대응이 가능함
- 즉, 발생시기를 예측하기 힘든 경우, 컨트롤러가 가장 빠르게 대응하기 위해선 인터럽트 방식을 사용

### 시스템 콜 System Call

- 시스템 콜이란?
  - 사용자 프로그램이 운영체제의 서비스를 받기 위해 커널함수를 호출하는 것
  - 시스템의 자원이나 서비스가 필요한 경우, 운영체제에 요청
- 해당 인터럽트 처리를 위해 OS로 CPU 제어권이 넘어가고, OS영역의 코드가 실행됨
- 인터럽트 라인을 읽어서 커널함수가 실행되는 원리
  - 사용자 프로그램에서 직접 OS영역의 호출을 하는 것 아님

##### 시스템 콜 동작과정

1. 사용자 프로세스가 시스템 콜 호출 (Kernel mode 진입)
2. 커널은 내부적으로 시스템 콜을 구분하기 위해 기능별로 고유번호 할당. 그 번호에 해당하는 제어루틴 정의
3. 커널은 요청받은 시스템 콜에 대응하는 고유번호 확인. 그에 맞는 서비스 루틴 호출
4. 커널은 서비스 루틴을 처리한 후, 사용자모드(User mode)로 전환
