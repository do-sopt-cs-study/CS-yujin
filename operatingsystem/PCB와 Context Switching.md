## PCB와 Context Switching

### PCB

> 프로세스 제어 블록 (PCB)
>
> - 하나의 프로세스가 만들어져 없어질때까지, 시스템에서 존재하는 모습
> - 프로세스 메타데이터들을 저장해두는 곳
> - 한개의 PCB 안에는 한개의 process 정보가 담긴다

##### PCB 과정

1. 프로그램 실행
2. 프로세스 생성 (프로그램을 메모리에 적재)
3. 프로세스 메타 데이터 생성
4. PCB에 메타 데이터 저장

#### Process Metadata

> 프로세스들의 특징
> -> CPU가 각 프로세스를 구분할 수 있고, 여러 개의 프로세스에 대해 관리할 수 있도록 함
> 즉, CPU가 프로세스를 처리하는데 필요한 다양한 정보

- 메타 데이터 종류
  - Process-id (프로세스 구분자): 메모리에 있는 여러 프로세스들을 구분하기 위한 존재
  - 메모리 관리 정보 : 실행하려는 프로세스가 어떤 메모리에 저장되어있는지 CPU가 알 수 있게 해줌
  - 등등 ,,

#### PCB의 필요성

- 프로세스가 여러개 생성될 때, 즉, 여러개의 프로그램이 실행되고 있을 때, CPU는 프로세스의 상태에 따라 교체 작업을 수행함
- 이때, 다시 수행되기 위해 대기 중인 프로세스에 관한 값을 PCB에 저장해두어야함
  - PCB는 Linked List 방식으로 관리
  - 즉, 프로세스가 생성되면 해당 PCB가 List Head에 삽입 되고, 프로세스 완료시 제거됨
- 이렇게 수행중인 프로세스를 변경할때, CPU의 레지스터 정보가 변경되는 것을 `Context Switching`이라고 함.

> 교체작업이란:
> Interrupt 발생 ->
> 할당받은 프로세스는 Waiting 상태로 변경 ->
> 다른 프로세스를 Running 상태로 변경

### Context Switching

- 수행중인 Task(Process, Thread)가 변경될 때, CPU의 레지스터 정보가 변경되는 것
- 즉, 이전 프로세스의 상태를 PCB에 보관하고, 다른 프로세스의 정보를 PCB에서 읽어와 CPU 레지스터에 적재하는 과정
- 예시
  - CPU 스케줄링에 의해 할당된 작업 시간이 끝나 timeout 발생
  - 프로세스의 작업 종료
  - 실행중이던 프로세스가 i/o 요청등의 이유로 interrupt 발생

> `Context` : CPU가 다루는 프로세스/스레드에 대한 정보. 대부분 레지스터에 저장되어, PCB로 관리함

#### Cost

- context Switching 발생 시 많은 Cost 발생
  - Cache 초기화
  - Memory mapping 초기화
  - kernel 항상 실행되어야함
- 즉, 잦은 Context Switching은 성능 저하로 이어질 수 있다.

#### Context Switching의 필요성

- CPU는 한번에 하나의 프로세스만 수행가능
- 하지만, 우리는 여러개의 프로세스를 동시에 수행하고자함
- 따라서, CPU는 여러개의 프로세스를 번갈아 수행하므로써(context switching), 동시에 수행하는 것 처럼 작동
